"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[182],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var i=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var u=i.createContext({}),s=function(e){var t=i.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=s(e.components);return i.createElement(u.Provider,{value:t},e.children)},h="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},p=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,u=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),h=s(n),p=o,g=h["".concat(u,".").concat(p)]||h[p]||d[p]||a;return n?i.createElement(g,r(r({ref:t},c),{},{components:n})):i.createElement(g,r({ref:t},c))}));function g(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,r=new Array(a);r[0]=p;var l={};for(var u in t)hasOwnProperty.call(t,u)&&(l[u]=t[u]);l.originalType=e,l[h]="string"==typeof e?e:o,r[1]=l;for(var s=2;s<a;s++)r[s]=n[s];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}p.displayName="MDXCreateElement"},2035:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>s});var i=n(7462),o=(n(7294),n(3905));const a={},r="OAuth Public Frontend Configuration",l={unversionedId:"guides/self-hosting/oauth/configuring-oauth",id:"guides/self-hosting/oauth/configuring-oauth",title:"OAuth Public Frontend Configuration",description:"As of v0.4.7, zrok includes OAuth integration for both Google and GitHub for zrok access public public frontends.",source:"@site/../docs/guides/self-hosting/oauth/configuring-oauth.md",sourceDirName:"guides/self-hosting/oauth",slug:"/guides/self-hosting/oauth/configuring-oauth",permalink:"/docs/guides/self-hosting/oauth/configuring-oauth",draft:!1,editUrl:"https://github.com/openziti/zrok/blob/main/docs/../docs/guides/self-hosting/oauth/configuring-oauth.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"OAuth",permalink:"/docs/category/oauth"},next:{title:"Docker Share",permalink:"/docs/category/docker-share"}},u={},s=[{value:"Planning for the OAuth Frontend",id:"planning-for-the-oauth-frontend",level:2},{value:"Configuring a Google OAuth Client ID",id:"configuring-a-google-oauth-client-id",level:2},{value:"OAuth Content Screen",id:"oauth-content-screen",level:3},{value:"Create the OAuth 2.0 Client ID",id:"create-the-oauth-20-client-id",level:3},{value:"Configuring a GitHub Client ID",id:"configuring-a-github-client-id",level:2},{value:"Configuring your Public Frontend",id:"configuring-your-public-frontend",level:2},{value:"Enabling OAuth on a Public Share",id:"enabling-oauth-on-a-public-share",level:2}],c={toc:s};function h(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,i.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"oauth-public-frontend-configuration"},"OAuth Public Frontend Configuration"),(0,o.kt)("p",null,"As of ",(0,o.kt)("inlineCode",{parentName:"p"},"v0.4.7"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"zrok")," includes OAuth integration for both Google and GitHub for ",(0,o.kt)("inlineCode",{parentName:"p"},"zrok access public")," public frontends. "),(0,o.kt)("p",null,"This integration allows you to create public shares and request that the public frontend authenticate your users against either the Google or GitHub OAuth endpoints (using the user's Google or GitHub accounts). Additionally, you can restrict the email address domain associated with the count to a list of domains that you provide when you create the share."),(0,o.kt)("p",null,"This is a first step towards a more comprehensive portfolio of user authentication strategies in future ",(0,o.kt)("inlineCode",{parentName:"p"},"zrok")," releases."),(0,o.kt)("h2",{id:"planning-for-the-oauth-frontend"},"Planning for the OAuth Frontend"),(0,o.kt)("p",null,"The current implementation of the OAuth public frontend uses a HTTP listener to handle redirects from OAuth providers. You'll need to configure a DNS name and a port for this listener that is accessible by your end users. We'll refer to this listener as the \"OAuth frontend\" in this guide."),(0,o.kt)("p",null,'We\'ll use the public DNS address of the OAuth frontend when creating the Google and GitHub OAuth clients below. This address is typically configured into these clients as the "redirect URL" where these clients will send the authenticated users after authentication.'),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"zrok")," OAuth frontend will capture the successful authentication and forward the user back to their original destination."),(0,o.kt)("h2",{id:"configuring-a-google-oauth-client-id"},"Configuring a Google OAuth Client ID"),(0,o.kt)("h3",{id:"oauth-content-screen"},"OAuth Content Screen"),(0,o.kt)("p",null,'Before you can configure an OAuth Client ID in Google Cloud, you have to configure the "OAuth content screen". '),(0,o.kt)("p",null,"In the Google Cloud console, navigate to: ",(0,o.kt)("inlineCode",{parentName:"p"},"APIs & Services > Credentials > OAuth content screen")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(7199).Z,width:"1469",height:"1141"})),(0,o.kt)("p",null,"Here you can give your ",(0,o.kt)("inlineCode",{parentName:"p"},"zrok")," public frontend an identity and branding to match your deployment."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(2795).Z,width:"1469",height:"1141"})),(0,o.kt)("p",null,"Describe what domains are authorized to access your public frontend and establish contact information."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(3923).Z,width:"1469",height:"1179"})),(0,o.kt)("p",null,"Add a non-sensitive scope for ",(0,o.kt)("inlineCode",{parentName:"p"},"../auth/userinfo.email"),". This is important as it allows the ",(0,o.kt)("inlineCode",{parentName:"p"},"zrok")," OAuth frontend to receive the email address of the authenticated user."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(2575).Z,width:"1469",height:"1179"})),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(72).Z,width:"1469",height:"1179"})),(0,o.kt)("p",null,"Now your OAuth content screen is configured."),(0,o.kt)("h3",{id:"create-the-oauth-20-client-id"},"Create the OAuth 2.0 Client ID"),(0,o.kt)("p",null,"Next we create the OAuth Client ID for your public frontend."),(0,o.kt)("p",null,"In the Google Cloud Console, navigate to: ",(0,o.kt)("inlineCode",{parentName:"p"},"APIs & Services > Credentials > + Create Credentials")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(5180).Z,width:"1469",height:"1179"})),(0,o.kt)("p",null,"Select ",(0,o.kt)("inlineCode",{parentName:"p"},"OAuth client ID")," from the ",(0,o.kt)("inlineCode",{parentName:"p"},"+ Create Credentials")," dropdown."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(5871).Z,width:"1469",height:"1179"})),(0,o.kt)("p",null,"Application type is ",(0,o.kt)("inlineCode",{parentName:"p"},"Web Application"),"."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(9572).Z,width:"1469",height:"1179"})),(0,o.kt)("p",null,'The most important bit here is the "Authorized redirect URIs". You\'re going to want to put a URL here that matches the ',(0,o.kt)("inlineCode",{parentName:"p"},"zrok")," OAuth frontend address that you configured at the start of this guide, but at the end of the URL you're going to append ",(0,o.kt)("inlineCode",{parentName:"p"},"/google/oauth")," to the URL."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(1115).Z,width:"1469",height:"1179"})),(0,o.kt)("p",null,"Save the client ID and the client secret. You'll configure these into your ",(0,o.kt)("inlineCode",{parentName:"p"},"frontend.yml"),"."),(0,o.kt)("p",null,"With this your Google OAuth client should be configured and ready."),(0,o.kt)("h2",{id:"configuring-a-github-client-id"},"Configuring a GitHub Client ID"),(0,o.kt)("p",null,"Register a new OAuth application through the GitHub settings for the account that owns the application."),(0,o.kt)("p",null,"Navigate to:",(0,o.kt)("inlineCode",{parentName:"p"},"Settings > Developer Settings > OAuth Apps > Register a new application")),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(9980).Z,width:"1469",height:"1179"})),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(4861).Z,width:"1469",height:"1179"})),(0,o.kt)("p",null,'The "Authorized callback URL" should be configured to match the OAuth frontend address you configured at the start of this guide, with ',(0,o.kt)("inlineCode",{parentName:"p"},"/github/oauth")," appended to the end."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(5758).Z,width:"1469",height:"1179"})),(0,o.kt)("p",null,"Create a new client secret."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(1995).Z,width:"1469",height:"1179"})),(0,o.kt)("p",null,"Save the client ID and the client secret. You'll configure these into your ",(0,o.kt)("inlineCode",{parentName:"p"},"frontend.yml"),"."),(0,o.kt)("h2",{id:"configuring-your-public-frontend"},"Configuring your Public Frontend"),(0,o.kt)("p",null,"The public frontend configuration includes a new ",(0,o.kt)("inlineCode",{parentName:"p"},"oauth")," section:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'oauth:\n  bind_address:                   0.0.0.0:8181\n  redirect_url:                   https://oauth.zrok.io\n  cookie_domain:                  zrok.io\n  hash_key:                       "the quick brown fox jumped over the lazy dog"\n  providers:\n    - name:                       google\n      client_id:                  "<client id from google>"\n      client_secret:              "<client secret from google>"\n    - name:                       github\n      client_id:                  "<client id from github>"\n      client_secret:              "<client secret from github>"\n      \n')),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"bind_address")," parameter determines where the OAuth frontend will bind. Should be in ",(0,o.kt)("inlineCode",{parentName:"p"},"ip:port")," format."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"redirect_url")," parameter determines the base URL where OAuth frontend requests will be redirected."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"cookie_domain")," is the domain where authentication cookies should be stored."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"hash_key")," is a unique string for your installation that is used to secure the authentication payloads for your public frontend."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"providers")," is a list of configured providers for this public frontend. The current implementation supports ",(0,o.kt)("inlineCode",{parentName:"p"},"google")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"github")," as options."),(0,o.kt)("p",null,"Both the ",(0,o.kt)("inlineCode",{parentName:"p"},"google")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"github")," providers accept a ",(0,o.kt)("inlineCode",{parentName:"p"},"client_id")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"client_secret")," parameter. These values are provided when you configure the OAuth clients at Google or GitHub."),(0,o.kt)("h2",{id:"enabling-oauth-on-a-public-share"},"Enabling OAuth on a Public Share"),(0,o.kt)("p",null,"With your public frontend configured to support OAuth, you can test this by creating a public share. There are new command line options to support this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ zrok share public\nError: accepts 1 arg(s), received 0\nUsage:\n  zrok share public <target> [flags]\n\nFlags:\n  -b, --backend-mode string               The backend mode {proxy, web, caddy} (default "proxy")\n      --basic-auth stringArray            Basic authentication users (<username:password>,...)\n      --frontends stringArray             Selected frontends to use for the share (default [public])\n      --headless                          Disable TUI and run headless\n  -h, --help                              help for public\n      --insecure                          Enable insecure TLS certificate validation for <target>\n      --oauth-check-interval duration     Maximum lifetime for OAuth authentication; reauthenticate after expiry (default 3h0m0s)\n      --oauth-email-domains stringArray   Allow only these email domains to authenticate via OAuth\n      --oauth-provider string             Enable OAuth provider [google, github]\n\nGlobal Flags:\n  -p, --panic     Panic instead of showing pretty errors\n  -v, --verbose   Enable verbose logging\n')),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"--oauth-provider")," flag enables OAuth for the share using the specified provider."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"--oauth-email-domains")," flag accepts a comma-separated list of authenticated email address domains that are allowed to access the share."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"--oauth-check-interval")," flag specifies how frequently the authentication must be checked."),(0,o.kt)("p",null,"An example public share:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ zrok share public --backend-mode web --oauth-provider github --oauth-email-domains zrok.io ~/public\n")))}h.isMDXComponent=!0},9980:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/github_create_oauth_application_1-dbb289a694d0c99b50cb949654d818f8.png"},4861:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/github_create_oauth_application_2-bc9d4c3f25853d608870eb220d00e5ee.png"},5758:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/github_create_oauth_application_3-7973d63cd117eaba72fbaeb4ff119a39.png"},1995:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/github_create_oauth_application_4-6fed398013c9e6c3a31e5721adac4a4c.png"},5180:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/google_create_credentials_1-e61ee7e8fa51bdc93feab84235a90673.png"},5871:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/google_create_credentials_2-60cf4edb52f453d605907c17400e0800.png"},9572:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/google_create_credentials_3-1b3db3f9057d8626d64c5466dbb05ec7.png"},1115:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/google_create_credentials_4-f720031df1d09f997a18842745e9ea0d.png"},7199:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/google_oauth_content_screen_2-b94a6456ce9b13e053b4c07d8f233e84.png"},2795:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/google_oauth_content_screen_3-edf62ea2b291b58093289d31c2dae58d.png"},3923:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/google_oauth_content_screen_4-4bc7e07b06c8a9a3c1e8f766f6f1c5a6.png"},2575:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/google_oauth_content_screen_5-7c375cf49d8e2e392ca12b584462ab59.png"},72:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/google_oauth_content_screen_6-9b0fe216a782ef378313650e99ea52a1.png"}}]);